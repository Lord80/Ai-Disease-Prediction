<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - All Users Prediction History</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="admin-history-wrap">
    <a href="/" class="back-btn">Go Back</a>
    <div class="history-toolbar">
      <h1 class="admin-history-title">ðŸ“Š All Users Prediction History</h1>
      <input 
        type="text" 
        id="searchBox" 
        class="admin-search" 
        onkeyup="filterTable()" 
        placeholder="ðŸ” Search username, disease, outcome..."
      >
    </div>

    {% if history %}
      <div class="table-responsive">
        <table id="historyTable" class="table-adv wide-table">
          <thead>
            <tr>
              <th class="sortable">ID <span class="sort-indicator"></span></th>
              <th class="sortable">Username <span class="sort-indicator"></span></th>
              <th>Fever</th>
              <th>Cough</th>
              <th>Fatigue</th>
              <th>Breathing</th>
              <th class="sortable">Age <span class="sort-indicator"></span></th>
              <th>Gender</th>
              <th>BP</th>
              <th>Cholesterol</th>
              <th>Top Disease 1</th>
              <th>Top Disease 2</th>
              <th>Top Disease 3</th>
              <th>Outcome</th>
              <th class="sortable">Date <span class="sort-indicator"></span></th>
            </tr>
          </thead>
          <tbody>
            {% for row in history %}
            <tr>
              <td>{{ row.id }}</td>
              <td>{{ row.username }}</td>
              <td>{{ row.fever }}</td>
              <td>{{ row.cough }}</td>
              <td>{{ row.fatigue }}</td>
              <td>{{ row.breathing }}</td>
              <td>{{ row.age }}</td>
              <td>{{ 'Male' if row.gender == 1 else 'Female' }}</td>
              <td>{{ row.bp }}</td>
              <td>{{ row.cholesterol }}</td>
              <td>{{ row.top_disease_1 }}</td>
              <td>{{ row.top_disease_2 }}</td>
              <td>{{ row.top_disease_3 }}</td>
              <td>
                {% if row.outcome == "Positive" %}
                  <span class="chip chip-red">{{ row.outcome }}</span>
                {% elif row.outcome == "Negative" %}
                  <span class="chip chip-green">{{ row.outcome }}</span>
                {% else %}
                  <span class="muted">â€”</span>
                {% endif %}
              </td>
              <td>{{ row.predicted_at }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="history-empty">No prediction history found.</p>
    {% endif %}

    
  </div>

  <script>
    function filterTable() {
      const input = document.getElementById("searchBox");
      const filter = input.value.toLowerCase();
      const table = document.getElementById("historyTable");
      const rows = table.getElementsByTagName("tr");

      for (let i = 1; i < rows.length; i++) {
        const rowText = rows[i].textContent.toLowerCase();
        rows[i].style.display = rowText.includes(filter) ? "" : "none";
      }
    }

    // â¬†ï¸â¬‡ï¸ Sortable columns
    document.querySelectorAll("th.sortable").forEach((th, index) => {
      th.addEventListener("click", () => {
        const table = th.closest("table");
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));
        const isAsc = th.classList.contains("asc");

        table.querySelectorAll("th").forEach(h => h.classList.remove("asc", "desc"));

        rows.sort((a, b) => {
          const aText = a.children[index].textContent.trim();
          const bText = b.children[index].textContent.trim();
          return isAsc
            ? bText.localeCompare(aText)
            : aText.localeCompare(bText);
        });

        rows.forEach(r => tbody.appendChild(r));
        th.classList.toggle("asc", !isAsc);
        th.classList.toggle("desc", isAsc);
      });
    });
  </script>
</body>
</html>
