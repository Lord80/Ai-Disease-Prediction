<!-- templates/admin_history.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Prediction History</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="admin-history-wrap">
    <a href="/" class="back-btn">Go Back</a>
    <!-- Toolbar -->
    <div class="history-toolbar">
      <h1 class="admin-history-title">📊 Admin - All Prediction History</h1>
      <input 
        type="text" 
        id="searchBox" 
        class="admin-search" 
        onkeyup="filterTable()" 
        placeholder="🔍 Search username, symptoms, timestamp..."
      >
    </div>

    {% if history %}
      <div class="table-responsive">
        <table id="historyTable" class="table-adv wide-table">
          <thead>
            <tr>
              <th class="sortable">Username <span class="sort-indicator"></span></th>
              <th class="sortable">Timestamp <span class="sort-indicator"></span></th>
              <th>Symptoms</th>
              <th>Prediction</th>
            </tr>
          </thead>
          <tbody>
            {% for row in history %}
            <tr>
              <td>{{ row.username }}</td>
              <td>{{ row.timestamp }}</td>
              <td>{{ row.symptoms or '—' }}</td>
              <td>
                {% if row.prediction %}
                  <span class="chip chip-blue">{{ row.prediction }}</span>
                {% else %}
                  <span class="muted">—</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="history-empty">No prediction history found.</p>
    {% endif %}
  </div>

  <script>
    // 🔎 Search filter
    function filterTable() {
      const input = document.getElementById("searchBox");
      const filter = input.value.toLowerCase();
      const table = document.getElementById("historyTable");
      const rows = table.getElementsByTagName("tr");

      for (let i = 1; i < rows.length; i++) {
        const rowText = rows[i].textContent.toLowerCase();
        rows[i].style.display = rowText.includes(filter) ? "" : "none";
      }
    }

    // ⬆️⬇️ Sortable columns
    document.querySelectorAll("th.sortable").forEach((th, index) => {
      th.addEventListener("click", () => {
        const table = th.closest("table");
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));
        const isAsc = th.classList.contains("asc");

        // Reset states
        table.querySelectorAll("th").forEach(h => h.classList.remove("asc", "desc"));

        rows.sort((a, b) => {
          const aText = a.children[index].textContent.trim();
          const bText = b.children[index].textContent.trim();
          return isAsc
            ? bText.localeCompare(aText)
            : aText.localeCompare(bText);
        });

        rows.forEach(r => tbody.appendChild(r));
        th.classList.toggle("asc", !isAsc);
        th.classList.toggle("desc", isAsc);
      });
    });
  </script>
</body>
</html>
